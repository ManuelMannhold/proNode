@if (isExpanded()) {
<div class="sidebar-backdrop" (click)="isExpanded.set(false)"></div>
}
<div class="container sidebar-layout" [class.is-expanded]="isExpanded()">
    <div class="project-main-directory-header mobile-only-toggle" (click)="toggleSidebar()">
        <mat-icon>{{ isExpanded() ? 'menu_open' : 'menu' }}</mat-icon>
        <h4 *ngIf="isExpanded()">Menü schließen</h4>
    </div>
    <div class="sidebar-header">
        <button class="action-btn primary" (click)="addFolder()" matRipple>
            <mat-icon>create_new_folder</mat-icon>
            <span>Neuer Projektordner</span>
        </button>

        <button class="action-btn secondary" (click)="openCreateNoteDialog()" matRipple>
            <mat-icon>edit_note</mat-icon>
            <span>Neue Notiz</span>
        </button>
    </div>

    <div class="project-main-directory sidebar" cdkDropList (cdkDropListDropped)="drop($event)">
        @for (folder of folders(); track folder.id) {
        <div class="folder-group" @folderAnimation>
            <div class="folder-item" cdkDrag>
                <mat-icon cdkDragHandle class="drag-handle">drag_indicator</mat-icon>

                <mat-icon class="chevron" [class.rotated]="isFolderExpanded(folder.id)" (click)="toggleFolder(folder)">
                    chevron_right
                </mat-icon>

                @if (folder.isEditing) {
                <input #nameInput [value]="folder.name" (keyup.enter)="saveName(folder.id, $event)"
                    (keyup.esc)="noteService.removeFolderStub(folder.id)" (blur)="saveName(folder.id, $event)"
                    placeholder="Ordnername..." autofocus>
                } @else {
                <div class="folder-content" (click)="selectFolder(folder.id)">
                    <mat-icon>{{ isFolderExpanded(folder.id) ? 'folder_open' : 'folder' }}</mat-icon>
                    <span class="folder-name" [matTooltip]="folder.name" matTooltipPosition="right"
                        [matTooltipDisabled]="folder.name.length < 20"> {{ folder.name }}
                    </span>
                </div>

                <button mat-icon-button [matMenuTriggerFor]="folderMenu" class="more-btn">
                    <mat-icon>more_vert</mat-icon>
                </button>

                <mat-menu #folderMenu="matMenu" class="custom-folder-menu" xPosition="before">
                    <button mat-menu-item (click)="noteService.setEditing(folder.id, true)">
                        <mat-icon>edit</mat-icon>
                        <span>Umbenennen</span>
                    </button>
                    <button mat-menu-item (click)="deleteFolder(folder.id)" style="color: #ff5252;">
                        <mat-icon style="color: #ff5252;">delete</mat-icon>
                        <span>Löschen</span>
                    </button>
                </mat-menu>
                }
            </div>

            @if (isFolderExpanded(folder.id) && folder.notes && folder.notes.length > 0) {
            <div class="notes-sub-list">
                @for (note of folder.notes; track note.id) {
                <div class="note-item" (click)="selectNote(note)" [class.active]="note.id === selectedNote()?.id">
                    <mat-icon class="note-icon">description</mat-icon>
                    <span class="note-title">{{ note.title }}</span>

                    <button class="delete-btn" (click)="onDeleteNote($event, note)">
                        <mat-icon>delete_outline</mat-icon>
                    </button>
                </div>
                }
            </div>
            }
        </div>
        }
    </div>

    <button mat-icon-button (click)="logout()" class="logout-button">
        <mat-icon>logout</mat-icon>
    </button>
</div>

<nav class="mobile-bottom-nav">
    <button class="nav-item" (click)="toggleSidebar()" [class.active]="isExpanded()">
        <mat-icon>folder</mat-icon>
        <span>Ordner</span>
    </button>

    <button class="nav-item action-button" (click)="openCreateNoteDialog()">
        <mat-icon>add</mat-icon>
    </button>

    <button class="nav-item" (click)="logout()">
        <mat-icon>person</mat-icon>
        <span>Profil</span>
    </button>
</nav>