<div class="login-page-wrapper">
    <ngx-particles id="tsparticles" [options]="particlesOptions"></ngx-particles>

    <div class="login-card">
        <div class="logo-section">
            <mat-icon class="logo-icon">account_tree</mat-icon>
            <div class="logo-container">
                <span class="bracket">{{ '{' }}</span>
                <span class="logo-text">ProNode</span>
                <span class="bracket">{{ '}' }}</span>
            </div>
            <p class="subtitle">Structure Your Ideas</p>
        </div>

        <h2>{{ isRegisterMode ? 'Create Account' : 'Welcome Back' }}</h2>

        <form class="login-form" [formGroup]="authForm" (ngSubmit)="onSubmit()">

            <mat-form-field appearance="outline" class="full-width">
                <mat-label>Email Address</mat-label>
                <input matInput type="email" formControlName="email" required placeholder="email@example.com" autocomplete="off">
                <mat-icon matSuffix>mail</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
                <mat-label>Password</mat-label>
                <input matInput type="password" formControlName="password" required placeholder="••••••••">
                <mat-icon matSuffix>lock</mat-icon>
            </mat-form-field>

            @if (isRegisterMode) {
            <mat-form-field appearance="outline" class="full-width">
                <mat-label>Confirm Password</mat-label>
                <input matInput type="password" formControlName="confirmPassword" required placeholder="••••••••">
                <mat-icon matSuffix>verified_user</mat-icon>

                @if (authForm.get('confirmPassword')?.touched &&
                authForm.get('password')?.value !== authForm.get('confirmPassword')?.value) {
                <mat-error>Passwörter sind nicht identisch</mat-error>
                }
            </mat-form-field>
            }

            @if (isRegisterMode && authForm.get('confirmPassword')?.value !== authForm.get('password')?.value &&
            authForm.get('confirmPassword')?.touched) {
            <mat-error>Passwörter sind nicht identisch</mat-error>
            }

            <button mat-raised-button color="primary" class="login-btn" type="submit"
                [disabled]="isLoading() || authForm.invalid">
                <span *ngIf="!isLoading()">{{ isRegisterMode ? 'Sign Up' : 'Log In' }}</span>
                <mat-spinner diameter="20" *ngIf="isLoading()"></mat-spinner>
            </button>

            <div class="auth-toggle">
                <span>
                    {{ isRegisterMode ? 'Already have an account?' : "Don't have an account?" }}
                    <a (click)="toggleRegisterMode()" class="toggle-link">
                        {{ isRegisterMode ? 'Log In' : 'Register now' }}
                    </a>
                </span>
            </div>

            <p class="error-text" *ngIf="errorMessage()">{{ errorMessage() }}</p>

            <div class="guest-section">
                <button mat-button class="guest-btn" type="button" (click)="loginAsGuest()" [disabled]="isLoading()">
                    <mat-icon>arrow_forward</mat-icon>
                    Continue as Guest
                </button>
            </div>

            <div class="divider">
                <span>or sign in with</span>
            </div>

            <div class="social-logins">
                <button mat-stroked-button class="social-btn" type="button" (click)="loginWithGoogle()">
                    <img src="https://authjs.dev/img/providers/google.svg" alt="Google"> Google
                </button>
                <button mat-stroked-button class="social-btn" type="button">
                    <img src="https://authjs.dev/img/providers/github.svg" alt="GitHub"> GitHub
                </button>
            </div>
        </form>
    </div>
</div>